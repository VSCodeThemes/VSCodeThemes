language: node_js
node_js:
- 6.10.3
env:
  global:
    # TF_VAR_region, TF_VAR_access_key, TF_VAR_secret_key
    secure: DrVXCpGk+BRipCXGdNM6pUizl3P6maO3v1+pi1p399N5dOFQqsgXGICNi4ztxxZyxX7pSiFTb61FoPGLE+OgGqHpCcRIZcbn1p6YLnShosRMtoV2byaajlgKbAKYrIi7TtfDro1EcrYw4EfJWfUeFX607wDepyygDiEtpciUMfC9584m067ipTv+d5iihIa5ig4LW6I55NmygzoAEBpLt8WhxqiPVTt8LdqippHFKPK7Kx24S7Z1nxMzZauZypDEQxA+2ttKgqz34cI4iOi97Y6Tburp77TOGAWLj7MQeGr20soL2WVJZ/rELisJrTOg3U7YlrhQNVy2QmPqcMAuJWhc7YF+LAfWGH4avTob1fRuJPSBF4HtiAYwKlZ+61ndDB56rsYWSg/fnDvI+JsrXtsk34b1wD2ihnXGxV/eQciefOgNiOTj4QtIll+XgpYUhTZnDuYnglKC62Tu3WnoQEisxhIBlHqzUbMWHipJwx3HOnHSGLfydHNk5JaRK8hokn9gfghChLWN8P/IzqHaA4KyulTg3Eri4Dl7AGDRyWUdkgEszbsjWWPUFAoIjHuGNPFa/DoYQTIFI/SasGmcN/F4YBYCp9bnv/E3lh2jcKLd9Z96Jyim4gy8ZiIuv1zTg7hBE1KCCHd6VrPD82RuvJvfIw7jzL8nwYRhq/cJ5LU=
before_install:
- curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
- sudo apt-key adv --keyserver pgp.mit.edu --recv D101F7899D41F3C3
- echo "deb http://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt-get update -qq
- sudo apt-get install -y -qq yarn
- curl -fSL "https://releases.hashicorp.com/terraform/0.11.1/terraform_0.11.1_linux_amd64.zip"
  -o terraform.zip
- sudo unzip terraform.zip -d /opt/terraform
- sudo ln -s /opt/terraform/terraform /usr/bin/terraform
- rm -f terraform.zip
cache:
  directories:
  - "$HOME/.yarn-cache"
install:
- yarn install --frozen-lockfile
script:
- yarn build
- yarn lint
- yarn test
- yarn install-production-dependencies
- yarn package
- yarn terraform-init
- yarn terraform-plan
deploy:
- provider: script
  skip_cleanup: true
  script: yarn terraform-apply
  on:
    repo: jschr/VSCodeThemes
    branch: production
